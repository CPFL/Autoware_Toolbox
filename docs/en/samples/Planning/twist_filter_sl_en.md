# Usage example of twist_filter_sl.slx
## 1. Run Autoware
Run Autoware to launch the ROS master.    
![autoware](../images/run_autoware.png)  

The Runtime Manager window is launched.  
![runtime_manager](../images/runtime_manager.png)  

## 2. Load vehicle model
Open the Setup tab of the Runtime Manager. Load a vehicle model.  
![setup_tab_load_vehicle_model](../images/setup_tab_load_vehicle_model.png)  

## 3. Load vector map and TF
Open the Map tab of the Runtime Manager. Load Vector Map and TF.  
![map_tab_load_vectormap_tf](../images/map_tab_load_vectormap_tf.png)  

## 4. Launch rviz
Launch the rviz by clicking the RViz button on the Runtime Manager.  
![click_rviz](../images/click_rviz.png)  

When rviz starts, select [File]-[Open Config] from the menu.  
![rviz_file_open_config](../images/rviz_file_open_config.png)

Select " ~/ Autoware / ros / src / .config / rviz / default.rviz" on the file dialog.  
![choose_file_to_open](../images/choose_file_to_open.png)

After Config setting, Vector Map is displayed on the rviz screen.  
![show_vectormap](../images/show_vectormap.png)

## 5. Settings on the Runtime Manager's Computing tab
(1) Click "app" of *waypoint_loader* and select the csv file where the route is stored.  
![waypoint_loader](../images/waypoint_loader.png)  
After selecting the csv file, check the *waypoint_loader* checkbox.  

(2) Click "app" of *vel_pose_connect* and check "Simulation Mode".  
![vel_pose_connect](images/vel_pose_connect.png)  
After setting the "Simulation Mode", check the *vel_pose_connect* checkbox.    

(3) Click "app" of *wf_simulator* and set "Initialize Source" to "Rviz".  
![wf_simulator_app](images/twist_filter/wf_simulator_app.png)  
After setting the "Initialize Source", check the *wf_simulator* checkbox.

(4) Check the checkboxes for lane_rule, lane_stop, lane_select, obstacle_avoid, velocity_set, twist_filter and wf_simulator. After setting, the Computing tab is as shown below.  
![computing_tab](images/twist_filter/computing_tab.png)

## 6. Connect MATLAB to Autoware (ROS Master)
Connect to the ROS master using the rosinit command in MATLAB.
Set the rosinit arguments according to your environment.  
```MATLAB
rosinit();
```  
![rosinit](../images/rosinit.png)

## 7. Open twist_filter created in Simulink.
Add the folder containing the twist_filter_sl.slx file to MATLAB search path, 
open the twist_filter Simulink model.  
```MATLAB
twist_filter_folder = fullfile(autoware.getRootDirectory(), ...  
                        'benchmark', 'computing', 'planning', 'motion', 'waypoint_follower', ... 
                        'twist_filter');
addpath(twist_filter_folder);
model = 'twist_filter_sl';
open_system(model);
```  
![twist_filter_sl_top](images/twist_filter/twist_filter_sl_top.png)
 
## 8. Run twist_filter created in Simulink
Run the Simulink model.  
```MATLAB
set_param(model, 'SimulationCommand', 'Start');
```

## 9. Set the initial position of the vehicle with rviz
 (1) Click "2D Pose Estimate" of rviz.  
 (2) Next, drag the mouse in the direction of movement from the initial position of the vehicle.

![](images/2D_Pose_Estimate.png)

<html><br></html>

## 10. Start path following
After a while after setting the initial position with rviz, path following starts.  
![result_waypoint_follower](images/result_waypoint_follower.png)

Click 
[here](./images/twist_filter/rosgraph_twist_filter.png) to check the node graph when this example is executed.
The node generated by twist_filter_sl is / twist_filter_sl_81473.

## 11. Clean up
Execute the following command to finish.  
```MATLAB
set_param(model, 'SimulationCommand', 'Stop');
close_system(model);
rosshutdown();
rmpath(twist_filter_folder);
clear('model', 'twist_filter_folder');
```
---
# Demo Video
[![Demo Video](https://i9.ytimg.com/vi/LNWJ1iG0WoE/mq2.jpg?sqp=CLDI3ukF&rs=AOn4CLAfKJEwYaf6EANbwuGWXy3p13xjtg)](https://youtu.be/LNWJ1iG0WoE)